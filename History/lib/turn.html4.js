!function(a){"use strict";function o(a,b,c){if(c[0]&&"object"!=typeof c[0]){if(b[c[0]])return b[c[0]].apply(a,Array.prototype.slice.call(c,1));throw u(c[0]+" is an invalid value")}return b.init.apply(a,c)}function p(a,b,c,d){return{css:{position:"absolute",top:a,left:b,overflow:d||"hidden","z-index":c||"auto"}}}function q(a,b,c,d,e){var f=1-e,g=f*f*f,h=e*e*e;return r(Math.round(g*a.x+3*e*f*f*b.x+3*e*e*f*c.x+h*d.x),Math.round(g*a.y+3*e*f*f*b.y+3*e*e*f*c.y+h*d.y))}function r(a,b){return{x:a,y:b}}function s(a,b){return Object.prototype.hasOwnProperty.call(b,a)}function t(){for(var a=["Moz","Webkit","Khtml","O","ms"],b=a.length,c="";b--;)a[b]+"Transform"in document.body.style&&(c="-"+a[b].toLowerCase()+"-");return c}function u(a){function b(a){this.name="TurnJsError",this.message=a}return b.prototype=new Error,b.prototype.constructor=b,new b(a)}function v(a){var b={top:0,left:0};do{b.left+=a.offsetLeft,b.top+=a.offsetTop}while(a=a.offsetParent);return b}function w(){return""}var c="",d="4.1.0",e=!1,f={down:"mousedown",move:"mousemove",up:"mouseup",over:"mouseover",out:"mouseout"},g={backward:["l"],forward:["r"],all:["l","r"]},h=["single","double"],i=["ltr","rtl"],j={acceleration:!0,display:"double",duration:600,page:1,gradients:!0,when:null},k={acceleration:!0,corners:"forward",cornerSize:100,duration:600,gradients:!0},l=6,m={init:function(b){if(this.length>1)throw u("This selector has more than 1 element");c=t();var d,e=0,g=this.data(),h=this.children();if(b=a.extend({width:this.width(),height:this.height(),direction:this.attr("dir")||this.css("direction")||"ltr"},j,b),g.opts=b,g.pageObjs={},g.pages={},g.pageWrap={},g.pagePlace={},g.pageMv=[],g.zoom=1,g.totalPages=b.pages||0,g.docEvents={mouseStart:function(a){for(var b in g.pages)if(s(b,g.pages)&&!1===n._eventStart.call(g.pages[b],a))return!1},mouseMove:function(a){for(var b in g.pages)s(b,g.pages)&&n._eventMove.call(g.pages[b],a)},mouseEnd:function(a){for(var b in g.pages)s(b,g.pages)&&n._eventEnd.call(g.pages[b],a)}},b.when)for(d in b.when)s(d,b.when)&&this.bind(d,b.when[d]);for(this.css({position:"relative",width:b.width,height:b.height}),this.turn("display",b.display),""!==b.direction&&this.turn("direction",b.direction),d=0;d<h.length;d++)"1"!=a(h[d]).attr("ignore")&&this.turn("addPage",h[d],++e);return a(this).bind(f.down,g.docEvents.mouseStart).bind("start",m._start).bind("end",m._end).bind("pressed",m._pressed).bind("released",m._released).bind("flip",m._flip),a(document).bind(f.move,g.docEvents.mouseMove).bind(f.up,g.docEvents.mouseEnd),this.turn("page",b.page),g.done=!0,this},addPage:function(b,c){var d,e,f=!1,g=this.data(),h=g.totalPages+1;if(g.destroying)return!1;if((d=/\bp([0-9]+)\b/.exec(a(b).attr("class")))&&(c=parseInt(d[1],10)),c){if(c==h)f=!0;else if(c>h)throw u('Page "'+c+'" cannot be inserted')}else c=h,f=!0;return c>=1&&c<=h&&(e="double"==g.display?c%2?" odd":" even":"",g.done&&this.turn("stop"),c in g.pageObjs&&m._movePages.call(this,c,1),f&&(g.totalPages=h),g.pageObjs[c]=a(b).css({float:"left"}).addClass("page p"+c+e),m._addPage.call(this,c),g.done&&this.turn("update"),m._removeFromDOM.call(this)),this},_addPage:function(b){var c=this.data(),d=c.pageObjs[b];if(d)if(m._necessPage.call(this,b)){if(!c.pageWrap[b]){var e=m._pageSize.call(this,b,!0);d.css({width:e.width,height:e.height}),c.pagePlace[b]=b,c.pageWrap[b]=a("<div/>",{class:"turn-page-wrapper",page:b,css:{position:"absolute",overflow:"hidden"}}).css(e),this.append(c.pageWrap[b]),c.pageWrap[b].prepend(c.pageObjs[b])}b&&1!=m._setPageLoc.call(this,b)||m._makeFlip.call(this,b)}else c.pagePlace[b]=0,c.pageObjs[b]&&c.pageObjs[b].remove()},hasPage:function(a){return s(a,this.data().pageObjs)},center:function(b){var c=this.data(),d=a(this).turn("size"),e=d.width/(2*c.zoom)-d.width/2;if("double"==c.display){var f=this.turn("view",b||c.tpage||c.page);"ltr"==c.direction?f[0]?f[1]||(e+=d.width/4):e-=d.width/4:f[0]?f[1]||(e-=d.width/4):e+=d.width/4}return a(this).css({marginLeft:e}),this},destroy:function(){var c=this.data();for(c.destroying=!0,a(this).unbind(f.down).unbind("end").unbind("first").unbind("flip").unbind("last").unbind("pressed").unbind("released").unbind("start").unbind("turning").unbind("turned").unbind("zooming"),a(document).unbind(f.move,c.docEvents.mouseMove).unbind(f.up,c.docEvents.mouseEnd);0!==c.totalPages;)this.turn("removePage",c.totalPages);return c.fparent&&c.fparent.remove(),c.shadow&&c.shadow.remove(),this.removeData(),c=null,this},is:function(){return"object"==typeof this.data().pages},zoom:function(b){var c=this.data();if("number"==typeof b){if(b<.001||b>100)throw u(b+" is not a value for zoom");var d=a.Event("zooming");if(this.trigger(d,[b,c.zoom]),d.isDefaultPrevented())return this;var e=a(this).turn("size"),f=1/c.zoom,g=Math.round(e.width*f*b),h=Math.round(e.height*f*b);return c.zoom=b,a(this).turn("stop").turn("size",g,h).css({marginTop:e.height*f/2-h/2}),c.opts.autoCenter?this.turn("center"):a(this).css({marginLeft:e.width*f/2-g/2}),m._updateShadow.call(this),this}return c.zoom},_pageSize:function(a,b){var c=this.data(),d={};if("single"==c.display)d.width=this.width(),d.height=this.height(),b&&(d.top=0,d.left=0,d.right="auto");else{var e=this.width()/2,f=this.height();if(c.pageObjs[a].hasClass("own-size")?(d.width=c.pageObjs[a].width(),d.height=c.pageObjs[a].height()):(d.width=e,d.height=f),b){var g=a%2;d.top=(f-d.height)/2,"ltr"==c.direction?(d[g?"right":"left"]=e-d.width,d[g?"left":"right"]="auto"):(d[g?"left":"right"]=e-d.width,d[g?"right":"left"]="auto")}}return d},_makeFlip:function(a){var b=this.data();if(!b.pages[a]&&b.pagePlace[a]==a){var d="single"==b.display,e=a%2;b.pages[a]=b.pageObjs[a].css(m._pageSize.call(this,a)).flip({page:a,next:e||d?a+1:a-1,turn:this,duration:b.opts.duration,acceleration:b.opts.acceleration,gradients:b.opts.gradients}).flip("disable",b.disabled)}return b.pages[a]},_makeRange:function(){var a,b;if(!(this.data().totalPages<1))for(b=this.turn("range"),a=b[0];a<=b[1];a++)m._addPage.call(this,a)},range:function(a){var b,c,d,e,f=this.data();if(a=a||f.tpage||f.page||1,e=m._view.call(this,a),a<1||a>f.totalPages)throw u('"'+a+'" is not a page for range');return e[1]=e[1]||e[0],e[0]>=1&&e[1]<=f.totalPages?(b=Math.floor((l-2)/2),f.totalPages-e[1]>e[0]?(c=Math.min(e[0]-1,b),d=2*b-c):(d=Math.min(f.totalPages-e[1],b),c=2*b-d)):(c=l-1,d=l-1),[Math.max(1,e[0]-c),Math.min(f.totalPages,e[1]+d)]},_necessPage:function(a){if(0===a)return!0;var b=this.data(),c=this.turn("range");return b.pageObjs[a].hasClass("fixed")||a>=c[0]&&a<=c[1]},_removeFromDOM:function(){var a,b=this.data();for(a in b.pageWrap)s(a,b.pageWrap)&&!m._necessPage.call(this,a)&&m._removePageFromDOM.call(this,a)},_removePageFromDOM:function(a){var b=this.data();if(b.pages[a]){var c=b.pages[a].data();n._moveFoldingPage.call(b.pages[a],!1),c.f&&c.f.fwrapper&&c.f.fwrapper.remove(),b.pages[a].removeData(),b.pages[a].remove(),delete b.pages[a]}b.pageObjs[a]&&b.pageObjs[a].remove(),b.pageWrap[a]&&(b.pageWrap[a].remove(),delete b.pageWrap[a]),delete b.pagePlace[a]},removePage:function(a){var b=this.data();if(a<1||a>b.totalPages)throw u("The page "+a+" doesn't exist");return b.pageObjs[a]&&(this.turn("stop"),m._removePageFromDOM.call(this,a),delete b.pageObjs[a]),m._movePages.call(this,a,-1),b.totalPages=b.totalPages-1,b.page>b.totalPages?this.turn("page",b.totalPages):m._makeRange.call(this),this},_movePages:function(a,b){var c,d=this,e=this.data(),f="single"==e.display,g=function(a){var c=a+b,g=c%2,h=g?" odd ":" even ";e.pageObjs[a]&&(e.pageObjs[c]=e.pageObjs[a].removeClass("p"+a+" odd even").addClass("p"+c+h)),e.pagePlace[a]&&e.pageWrap[a]&&(e.pagePlace[c]=c,e.pageObjs[c].hasClass("fixed")?e.pageWrap[c]=e.pageWrap[a].attr("page",c):e.pageWrap[c]=e.pageWrap[a].css(m._pageSize.call(d,c,!0)).attr("page",c),e.pages[a]&&(e.pages[c]=e.pages[a].flip("options",{page:c,next:f||g?c+1:c-1,corners:f?"all":g?"forward":"backward"})),b&&(delete e.pages[a],delete e.pagePlace[a],delete e.pageObjs[a],delete e.pageWrap[a],delete e.pageObjs[a]))};if(b>0)for(c=e.totalPages;c>=a;c--)g(c);else for(c=a;c<=e.totalPages;c++)g(c)},display:function(b){var c=this.data(),d=c.display;if(b){if(-1==a.inArray(b,h))throw u('"'+b+'" is not a value for display');if("single"==b?c.pageObjs[0]||(this.turn("stop").css({overflow:"hidden"}),c.pageObjs[0]=a("<div />",{class:"page p-temporal"}).css({width:this.width(),height:this.height()}).appendTo(this)):c.pageObjs[0]&&(this.turn("stop").css({overflow:""}),c.pageObjs[0].remove(),delete c.pageObjs[0]),c.display=b,d){var e=this.turn("size");m._movePages.call(this,1,0),this.turn("size",e.width,e.height).turn("update")}return this}return d},direction:function(b){var c=this.data();if(void 0===b)return c.direction;if(b=b.toLowerCase(),-1==a.inArray(b,i))throw u('"'+b+'" is not a value for direction');return"rtl"==b&&a(this).attr("dir","ltr").css({direction:"ltr"}),c.direction=b,c.done&&this.turn("size",a(this).width(),a(this).height()),this},animating:function(){return this.data().pageMv.length>0},disable:function(b){var c,d=this.data(),e=this.turn("view");d.disabled=void 0===b||!0===b;for(c in d.pages)s(c,d.pages)&&d.pages[c].flip("disable",!!b&&a.inArray(c,e));return this},disabled:function(a){return void 0===a?!0===this.data().disabled:this.turn("disable",a)},size:function(a,b){if(a&&b){var c,d,e=this.data(),f="double"==e.display?a/2:a;this.css({width:a,height:b}),e.pageObjs[0]&&e.pageObjs[0].css({width:f,height:b});for(c in e.pageWrap)s(c,e.pageWrap)&&(d=m._pageSize.call(this,c,!0),e.pageObjs[c].css({width:d.width,height:d.height}),e.pageWrap[c].css(d),e.pages[c]&&e.pages[c].css({width:d.width,height:d.height}));return this.turn("resize"),this}return{width:this.width(),height:this.height()}},resize:function(){var a,b=this.data();for(b.pages[0]&&(b.pageWrap[0].css({left:-this.width()}),b.pages[0].flip("resize",!0)),a=1;a<=b.totalPages;a++)b.pages[a]&&b.pages[a].flip("resize",!0)},_removeMv:function(a){var b,c=this.data();for(b=0;b<c.pageMv.length;b++)if(c.pageMv[b]==a)return c.pageMv.splice(b,1),!0;return!1},_addMv:function(a){var b=this.data();m._removeMv.call(this,a),b.pageMv.push(a)},_view:function(a){var b=this.data();return a=a||b.page,"double"==b.display?a%2?[a-1,a]:[a,a+1]:[a]},view:function(a){var b=this.data(),c=m._view.call(this,a);return"double"==b.display?[c[0]>0?c[0]:0,c[1]<=b.totalPages?c[1]:0]:[c[0]>0&&c[0]<=b.totalPages?c[0]:0]},stop:function(a,b){if(this.turn("animating")){var c,d,e,f=this.data(),g=f.pageMv;for(f.pageMv=[],f.tpage&&(f.page=f.tpage,delete f.tpage),c=0;c<g.length;c++)e=f.pages[g[c]],d=e.data().f.opts,e.flip("hideFoldedPage",!1),n._moveFoldingPage.call(e,!1),f.pagePlace[d.next]=d.next,d.force&&(d.next=d.page%2==0?d.page-1:d.page+1,delete d.force)}return this.turn("update"),this},pages:function(a){var b=this.data();if(a){if(a<b.totalPages){for(var c=a+1;c<=b.totalPages;c++)this.turn("removePage",c);this.turn("page")>a&&this.turn("page",a)}return b.totalPages=a,this}return b.totalPages},_missing:function(a){var b,c=this.data(),d=this.turn("range",a),e=[];for(b=d[0];b<=d[1];b++)c.pageObjs[b]||e.push(b);e.length>0&&this.trigger("missing",[e])},_fitPage:function(a){var b=this.data(),c=this.turn("view",a);m._missing.call(this,a),b.pageObjs[a]&&(b.page=a,this.turn("stop"),m._removeFromDOM.call(this),m._makeRange.call(this),m._updateShadow.call(this),this.trigger("turned",[a,c]),b.opts.autoCenter&&this.turn("center"))},_turnPage:function(b,c){var d,e,f=this.data(),g=f.pagePlace[b],h=this.turn("view"),i=this.turn("view",b);if(f.page!=b){var j=a.Event("turning");if(this.trigger(j,[b,i]),j.isDefaultPrevented())return;-1!=a.inArray(1,i)&&this.trigger("first"),-1!=a.inArray(f.totalPages,i)&&this.trigger("last")}if(c)this.turn("stop",g);else{if(m._missing.call(this,b),!f.pageObjs[b])return;this.turn("stop"),f.page=b}if(m._makeRange.call(this),"single"==f.display?(d=h[0],e=i[0]):h[1]&&b>h[1]?(d=h[1],e=i[0]):h[0]&&b<h[0]&&(d=h[0],e=i[1]),f.pages[d]){var k=f.pages[d].data().f.opts;f.tpage=e,k.next!=e&&(k.next=e,f.pagePlace[e]=k.page,k.force=!0),"single"==f.display?"ltr"==f.direction?f.pages[d].flip("turnPage",i[0]>h[0]?"r":"l"):f.pages[d].flip("turnPage",i[0]>h[0]?"l":"r"):f.pages[d].flip("turnPage")}},page:function(b){b=parseInt(b,10);var c=this.data();return b>0&&b<=c.totalPages?(c.done&&-1==a.inArray(b,this.turn("view"))?m._turnPage.call(this,b):m._fitPage.call(this,b),this):c.page},next:function(){return this.turn("page",m._view.call(this,this.data().page).pop()+1)},previous:function(){return this.turn("page",m._view.call(this,this.data().page).shift()-1)},peel:function(a,b){return this},_addMotionPage:function(){var b=a(this).data().f.opts,c=b.turn,d=c.data();m._addMv.call(c,b.page),d.pagePlace[b.next]=b.page,c.turn("update")},_start:function(a,b,c){var d=b.turn.data();if(a.isDefaultPrevented())return void m._updateShadow.call(b.turn);"single"==d.display&&c&&("l"==c&&"ltr"==d.direction||"r"==c&&"rtl"==d.direction?(b.next=b.next<b.page?b.next:b.page-1,b.force=!0):b.next=b.next>b.page?b.next:b.page+1),m._addMotionPage.call(a.target),m._updateShadow.call(b.turn)},_end:function(b,c,d){var e=a(b.target),g=(e.data().f,c.turn),h=g.data();d||h.tpage?h.tpage!=c.next&&h.tpage!=c.page||(delete h.tpage,m._fitPage.call(g,h.tpage||c.next,!0)):(m._removeMv.call(g,c.page),m._updateShadow.call(g),g.turn("update"))},_pressed:function(b){b.stopPropagation();var c,d=a(b.target).data().f,e=d.opts.turn.data().pages;for(c in e)c!=d.opts.page&&e[c].flip("disable",!0);return d.time=(new Date).getTime()},_released:function(b,c){b.stopPropagation();var d,e=a(b.target),f=e.data().f,g=f.opts.turn,h=g.data();d="single"==h.display?"r"==c.corner?c.x<e.width()/2:c.x>e.width()/2:c.x<0||c.x>e.width(),((new Date).getTime()-f.time<200||d)&&(b.preventDefault(),m._turnPage.call(g,f.opts.next,!1===n._cornerActivated.call(e,c,1))),h.mouseAction=!1},_flip:function(b){b.stopPropagation();var c=a(b.target).data().f.opts;c.turn.trigger("turn",[c.next]),c.turn.data().opts.autoCenter&&c.turn.turn("center",c.next)},calculateZ:function(a){var b,c,d,e,f,g=this,h=this.data(),i=this.turn("view"),j=i[0]||i[1],k={pageZ:{},partZ:{},pageV:{}},l=function(a){var b=g.turn("view",a);b[0]&&(k.pageV[b[0]]=!0),b[1]&&(k.pageV[b[1]]=!0)};for(b=0;b<a.length;b++)c=a[b],d=h.pages[c].data().f.opts.next,e=h.pagePlace[c],l(c),l(d),f=h.pagePlace[d]==d?d:c,k.pageZ[f]=h.totalPages-Math.abs(j-f),k.partZ[e]=2*h.totalPages+Math.abs(j-f);return k},update:function(){var a,b=this.data();if(b.pageMv.length&&0!==b.pageMv[0]){var c,d,e=this.turn("calculateZ",b.pageMv);this.turn("view",b.tpage);for(a in b.pageWrap)s(a,b.pageWrap)&&(d=b.pageObjs[a].hasClass("fixed"),b.pageWrap[a].css({display:e.pageV[a]||d?"":"none","z-index":e.pageZ[a]||(d?-1:0)}),(c=b.pages[a])&&(c.flip("z",e.partZ[a]||null),e.pageV[a]&&c.flip("resize"),b.tpage&&c.flip("disable",!0)))}else for(a in b.pageWrap)if(s(a,b.pageWrap)){var g=m._setPageLoc.call(this,a);b.pages[a]&&b.pages[a].flip("disable",b.disabled||1!=g).flip("z",null)}},_updateShadow:function(){var b,c,e=this.data(),f=this.width(),g=this.height(),h="single"==e.display?f:f/2;b=this.turn("view"),e.shadow||(e.shadow=a("<div />",{class:"shadow",css:p(0,0,0).css}).appendTo(this));for(var i=0;i<e.pageMv.length&&(b[0]&&b[1]);i++)b=this.turn("view",e.pages[e.pageMv[i]].data().f.opts.next),c=this.turn("view",e.pageMv[i]),b[0]=b[0]&&c[0],b[1]=b[1]&&c[1];switch(b[0]?b[1]?3:"ltr"==e.direction?2:1:"ltr"==e.direction?1:2){case 1:e.shadow.css({width:h,height:g,top:0,left:h});break;case 2:e.shadow.css({width:h,height:g,top:0,left:0});break;case 3:e.shadow.css({width:f,height:g,top:0,left:0})}},_setPageLoc:function(a){var b=this.data(),c=this.turn("view");return a==c[0]||a==c[1]?(b.pageWrap[a].css({zIndex:b.totalPages,display:""}),1):"single"==b.display&&a==c[0]+1||"double"==b.display&&a==c[0]-2||a==c[1]+2?(b.pageWrap[a].css({zIndex:b.totalPages-1,display:""}),2):(b.pageWrap[a].css({zIndex:0,display:b.pageObjs[a].hasClass("fixed")?"":"none"}),0)},options:function(b){if(void 0===b)return this.data().opts;var c=this.data();if(a.extend(c.opts,b),b.pages&&this.turn("pages",b.pages),b.page&&this.turn("page",b.page),b.display&&this.turn("display",b.display),b.direction&&this.turn("direction",b.direction),b.width&&b.height&&this.turn("size",b.width,b.height),b.when)for(var d in b.when)s(d,b.when)&&this.unbind(d).bind(d,b.when[d]);return this},version:function(){return d}},n={init:function(a){return this.data({f:{effect:"r"==a.corners||"l"==a.corners?"hard":"sheet"}}),this.flip("options",a),n._addPageWrapper.call(this),this},setData:function(b){var c=this.data();return c.f=a.extend(c.f,b),this},options:function(b){var c=this.data().f;return b?(n.setData.call(this,{opts:a.extend({},c.opts||k,b)}),this):c.opts},z:function(a){var b=this.data().f;return b.fwrapper&&(b.opts["z-index"]=a,b.fwrapper.css({"z-index":a||parseInt(b.parent.css("z-index"),10)||0})),this},_cAllowed:function(){var a=this.data().f,b=a.opts.turn.data(),c=a.opts.page,d=c%2;return"single"==b.display?1==c?"ltr"==b.direction?g.forward:g.backward:c==b.totalPages?"ltr"==b.direction?g.backward:g.forward:g.all:"ltr"==b.direction?g[d?"forward":"backward"]:g[d?"backward":"forward"]},_cornerActivated:function(b){var c=this.data().f,d=c.parent.offset(),e=this.width(),f=this.height(),g={x:Math.max(0,b.pageX-d.left),y:Math.max(0,b.pageY-d.top)},h=c.opts.cornerSize;if(g.x<=0||g.y<=0||g.x>=e||g.y>=f)return!1;var i=n._cAllowed.call(this);if(g.x>e-h)g.corner="r";else{if(!(g.x<h))return!1;g.corner="l"}return-1!=a.inArray(g.corner,i)&&g},_c:function(a,b){switch(b=b||0,a){case"l":return r(b,0);case"r":return r(this.width()-b,0)}},_c2:function(a){switch(a){case"l":return r(2*this.width(),0);case"r":return r(-this.width(),0)}},_foldingPage:function(a){var b=this.data().f,c=b.opts;return b.folding?b.folding:c.turn?(b=c.turn.data(),"single"==b.display?b.pageObjs[c.next]?b.pageObjs[0]:null:b.pageObjs[c.next]):void 0},_backGradient:function(){var a=this.data().f,b=a.opts.turn;return a.opts.gradients&&(!b||"single"==b.data().display||2!=a.opts.page&&a.opts.page!=b.data().totalPages-1)},resize:function(a){var b=this.data().f,c=this.width(),d=this.height();a&&(b.wrapper.css({width:c,height:d}),b.fpage.css({width:c,height:d}))},_addPageWrapper:function(){var c=this.data().f,d=this.parent();if(c.parent=d,!c.wrapper){var e={};c.wrapper=a("<div/>",p(0,0,2)).css(e).appendTo(d).prepend(this),c.fpage=a("<div/>",p(0,0,1)).css(e).appendTo(d)}n.resize.call(this,!0)},_fold:function(a){var b=this.data().f,c=n._c.call(this,a.corner),d=c.x?c.x-a.x:a.x,e=this.width();this.height();switch(d=Math.min(2*e,Math.max(0,d)),a.corner){case"r":b.wrapper.css({width:Math.max(0,e-d)}),this.css({position:"relative",left:-d}),b.fpage.css({left:-d+e,width:Math.max(0,d-e)});break;case"l":b.wrapper.css({width:e}),this.css({position:"relative",left:d}),b.fpage.css({left:e,width:Math.max(0,d-e)}),b.folding&&b.folding.css({position:"relative",left:2*-e+d})}b.parent.css({overflow:"visible"}),b.point=a},_moveFoldingPage:function(a){var b=this.data().f;if(a){var c=n._foldingPage.call(this),d=b.opts.turn;if(c){if(b.folding){if(b.folding===c)return;n._moveFoldingPage.call(this,!1)}n.setData.call(this,{backParent:c.parent(),folding:c}),b.fpage.prepend(c)}d.turn("update")}else b.backParent&&(b.backParent.prepend(b.folding),delete b.backParent,delete b.folding)},_showFoldedPage:function(b,c){var d=n._foldingPage.call(this),e=this.data(),f=e.f,g=f.visible;if(!g||!f.point||f.point.corner!=b.corner){var i=(f.opts.turn.data().mouseAction,a.Event("start"));if(this.trigger(i,[f.opts,b.corner]),g=!1,i.isDefaultPrevented())return!1}if(d){if(c){var j=this,k=f.point&&f.point.corner==b.corner?f.point:n._c.call(this,b.corner,1);this.animatef({from:[k.x,k.y],to:[b.x,b.y],duration:500,frame:function(a){b.x=Math.round(a[0]),b.y=Math.round(a[1]),n._fold.call(j,b)}})}else n._fold.call(this,b),e.effect&&!e.effect.turning&&this.animatef(!1);return g||(f.visible=!0,n._moveFoldingPage.call(this,!0),f.fpage.show()),!0}return!1},hide:function(){var a=this.data().f;n._foldingPage.call(this);return this.css({position:"",left:"auto"}),a.wrapper.css({width:this.width()}),a.fpage.css({width:this.width()}),a.folding&&a.folding.css({position:"",left:"auto"}),a.fpage.hide(),a.visible=!1,this},hideFoldedPage:function(a){var b=this.data().f;if(b.point){var c=this,d=b.point,e=function(){b.point=null,c.flip("hide"),c.trigger("end",[b.opts,!1])};if(a){var f=n._c.call(this,d.corner),g="t"==d.corner.substr(0,1),h=g?Math.min(0,d.y-f.y)/2:Math.max(0,d.y-f.y)/2,i=r(d.x,d.y+h),j=r(f.x,f.y-h);this.animatef({from:0,to:1,frame:function(a){var b=q(d,i,j,f,a);d.x=b.x,d.y=b.y,n._fold.call(c,d)},complete:e,duration:800,hiding:!0})}else this.animatef(!1),e()}},turnPage:function(a){var b=this,c=this.data().f;a={corner:c.corner?c.corner.corner:a||n._cAllowed.call(this)[0]};var d=c.point||n._c.call(this,a.corner,c.opts.turn?c.opts.turn.data().opts.elevation:0),e=n._c2.call(this,a.corner);this.trigger("flip").animatef({from:0,to:1,frame:function(c){var f=q(d,d,e,e,c);a.x=f.x,a.y=f.y,n._showFoldedPage.call(b,a)},complete:function(){b.trigger("end",[c.opts,!0])},duration:c.opts.duration,turning:!0}),c.corner=null},moving:function(){return"effect"in this.data()},isTurning:function(){return this.flip("moving")&&this.data().effect.turning},_eventStart:function(a){var b=this.data().f;if(!b.disabled&&!this.flip("isTurning")){if(b.corner=n._cornerActivated.call(this,a),b.corner&&n._foldingPage.call(this,b.corner))return n._showFoldedPage.call(this,b.corner)&&this.trigger("pressed",[b.point]),!1;b.corner=null}},_eventMove:function(a){var b=this.data().f;if(!b.disabled)if(a=e?a.originalEvent.touches:[a],b.corner){var c=b.parent.offset();b.corner.x=a[0].pageX-c.left,b.corner.y=a[0].pageY-c.top,n._showFoldedPage.call(this,b.corner)}else if(!this.data().effect&&this.is(":visible")){var d=n._cornerActivated.call(this,a[0]);if(d){var f=n._c.call(this,d.corner,b.opts.cornerSize/2);d.x=f.x,d.y=f.y,n._showFoldedPage.call(this,d,!0)}else n.hideFoldedPage.call(this,!0)}},_eventEnd:function(){var b=this.data().f;if(!b.disabled&&b.point){var c=a.Event("released");this.trigger(c,[b.point]),c.isDefaultPrevented()||n.hideFoldedPage.call(this,!0)}b.corner=null},disable:function(a){return n.setData.call(this,{disabled:a}),this}};window.requestAnim=function(a){window.setTimeout(a,1e3/60)},a.extend(a.fn,{flip:function(a,b){return o(this,n,arguments)},turn:function(a){return o(this,m,arguments)},transform:function(a,b){var d={};return b&&(d[c+"transform-origin"]=b),d[c+"transform"]=a,this.css(d)},animatef:function(b){var c=this.data();if(c.effect&&c.effect.stop(),b){b.to.length||(b.to=[b.to]),b.from.length||(b.from=[b.from]);for(var d=[],e=b.to.length,f=!0,g=this,h=(new Date).getTime(),i=function(){if(c.effect&&f){for(var a=[],j=Math.min(b.duration,(new Date).getTime()-h),k=0;k<e;k++)a.push(c.effect.easing(1,j,b.from[k],d[k],b.duration));b.frame(1==e?a[0]:a),j==b.duration?(delete c.effect,g.data(c),b.complete&&b.complete()):window.requestAnim(i)}},j=0;j<e;j++)d.push(b.to[j]-b.from[j]);c.effect=a.extend({stop:function(){f=!1},easing:function(a,b,c,d,e){return d*Math.sqrt(1-(b=b/e-1)*b)+c}},b),this.data(c),i()}else delete c.effect}}),a.isTouch=e,a.mouseEvents=f,a.cssPrefix=w,a.cssTransitionEnd=w,a.findPos=v}(jQuery);
