!function(a){"use strict";function e(a,b){return a[0]!=b[0]&&(!!a.attr("page")||!!a.parent()[0]&&e(a.parent(),b))}function f(a){function b(a){this.name="TurnJsError",this.message=a}return b.prototype=new Error,b.prototype.constructor=b,new b(a)}function g(a,c,d){return b&&d?" translate3d("+a+"px,"+c+"px, 0px) ":" translate("+a+"px, "+c+"px) "}function h(a,c){return b&&c?" scale3d("+a+", "+a+", 1) ":" scale("+a+") "}function i(a,b){return{x:a,y:b}}function j(a,b){return function(){return a.apply(b,arguments)}}var b,c={max:2,flipbook:null,easeFunction:"ease-in-out",duration:500,when:{}},d={init:function(e){var g=this,h=this.data(),k=a.extend({},c,e);if(!k.flipbook||!k.flipbook.turn("is"))throw f("options.flipbook is required");if(b="WebKitCSSMatrix"in window||"MozPerspective"in document.body.style,"function"!=typeof k.max){var l=k.max;k.max=function(){return l}}h.zoom={opts:k,axis:i(0,0),scrollPos:i(0,0),eventQueue:[],mouseupEvent:function(){return d._eMouseUp.apply(g,arguments)},eventTouchStart:j(d._eTouchStart,g),eventTouchMove:j(d._eTouchMove,g),eventTouchEnd:j(d._eTouchEnd,g),flipbookEvents:{zooming:j(d._eZoom,g),pressed:j(d._ePressed,g),released:j(d._eReleased,g),start:j(d._eStart,g),turning:j(d._eTurning,g),turned:j(d._eTurned,g),destroying:j(d._eDestroying,g)}};for(var m in k.when)Object.prototype.hasOwnProperty.call(k.when,m)&&this.bind("zoom."+m,k.when[m]);for(m in h.zoom.flipbookEvents)Object.prototype.hasOwnProperty.call(h.zoom.flipbookEvents,m)&&k.flipbook.bind(m,h.zoom.flipbookEvents[m]);this.css({position:"relative",overflow:"hidden"}),a.isTouch?(k.flipbook.bind("touchstart",h.zoom.eventTouchStart).bind("touchmove",h.zoom.eventTouchMove).bind("touchend",h.zoom.eventTouchEnd),this.bind("touchstart",d._tap)):this.mousedown(d._mousedown).click(d._tap)},_tap:function(b){var c=a(this),f=c.data().zoom;f.opts.flipbook;if(!f.draggingCorner&&!f.dragging&&e(a(b.target),c)){d._addEvent.call(c,"tap",b);var h=d._eventSeq.call(c);h&&c.trigger(h)}},_addEvent:function(a,b){var c=this.data().zoom,d=(new Date).getTime(),e={name:a,timestamp:d,event:b};c.eventQueue.push(e),c.eventQueue.length>10&&c.eventQueue.splice(0,1)},_eventSeq:function(){var b=this.data().zoom,c=b.eventQueue,d=c.length-1;return d>0&&"tap"==c[d].name&&"tap"==c[d-1].name&&c[d].event.pageX==c[d-1].event.pageX&&c[d].event.pageY==c[d-1].event.pageY&&c[d].timestamp-c[d-1].timestamp<200&&c[d].timestamp-c[d-1].timestamp>50?a.extend(c[d].event,{type:"zoom.doubleTap"}):"tap"==c[d].name?a.extend(c[d].event,{type:"zoom.tap"}):void 0},_prepareZoom:function(){var b,c=0,d=this.data().zoom,e=1/this.zoom("value"),f=d.opts.flipbook,g=f.turn("direction"),h=f.data(),j=f.offset(),k=this.offset(),l={height:f.height()},m=f.turn("view");"double"==f.turn("display")&&f.data().opts.autoCenter?m[0]?m[1]?(l.width=f.width(),b=i(j.left-k.left,j.top-k.top)):(l.width=f.width()/2,c="ltr"==g?0:l.width,b=i("ltr"==g?j.left-k.left:j.left-k.left+l.width,j.top-k.top)):(l.width=f.width()/2,c="ltr"==g?l.width:0,b=i("ltr"==g?j.left-k.left+l.width:j.left-k.left,j.top-k.top)):(l.width=f.width(),b=i(j.left-k.left,j.top-k.top)),d.zoomer||(d.zoomer=a("<div />",{class:"zoomer",css:{overflow:"hidden",position:"absolute",zIndex:"1000000"}}).mousedown(function(){return!1}).appendTo(this)),d.zoomer.css({top:b.y,left:b.x,width:l.width,height:l.height});var n=m.join(",");if(n!=d.zoomerView){d.zoomerView=n,d.zoomer.find("*").remove();for(var o=0;o<m.length;o++)if(m[o]){var p=h.pageObjs[m[o]].offset(),q=a(h.pageObjs[m[o]]);q.clone().transform("").css({width:q.width()*e,height:q.height()*e,position:"absolute",display:"",top:(p.top-j.top)*e,left:(p.left-j.left-c)*e}).appendTo(d.zoomer)}}return{pos:b,size:l}},value:function(){return this.data().zoom.opts.flipbook.turn("zoom")},zoomIn:function(b){var c,e=this,f=this.data().zoom,j=f.opts.flipbook,k=f.opts.max(),m=(j.offset(),this.offset());if(f.zoomIn)return this;j.turn("stop");var n=a.Event("zoom.change");if(this.trigger(n,[k]),n.isDefaultPrevented())return this;var o=d._prepareZoom.call(this),p=o.pos,q=i(o.size.width/2,o.size.height/2),r=a.cssPrefix(),s=a.cssTransitionEnd(),t=j.data().opts.autoCenter;f.scale=k,j.data().noCenter=!0,c=void 0!==b?"x"in b&&"y"in b?i(b.x-p.x,b.y-p.y):a.isTouch?i(b.originalEvent.touches[0].pageX-p.x-m.left,b.originalEvent.touches[0].pageY-p.y-m.top):i(b.pageX-p.x-m.left,b.pageY-p.y-m.top):i(q.x,q.y),(c.x<0||c.y<0||c.x>o.width||c.y>o.height)&&(c.x=q.x,c.y=q.y);var u=i((c.x-q.x)*k+q.x,(c.y-q.y)*k+q.y),v=i(o.size.width*k>this.width()?c.x-u.x:0,o.size.height*k>this.height()?c.y-u.y:0),w=i(Math.abs(o.size.width*k-this.width()),Math.abs(o.size.height*k-this.height())),x=i(Math.min(0,o.size.width*k-this.width()),Math.min(0,o.size.height*k-this.height())),y=i(q.x*k-q.x-p.x-v.x,q.y*k-q.y-p.y-v.y);y.y>w.y?v.y=y.y-w.y+v.y:y.y<x.y&&(v.y=y.y-x.y+v.y),y.x>w.x?v.x=y.x-w.x+v.x:y.x<x.x&&(v.x=y.x-x.x+v.x),y=i(q.x*k-q.x-p.x-v.x,q.y*k-q.y-p.y-v.y);var z={};z[r+"transition"]=r+"transform "+f.opts.easeFunction+" "+f.opts.duration+"ms";var A=function(){e.trigger("zoom.zoomIn"),f.zoomIn=!0,f.flipPosition=i(j.css("left"),j.css("top")),j.turn("zoom",k).css({position:"absolute",margin:"",top:0,left:0});var b=j.offset();f.axis=i(b.left-m.left,b.top-m.top),t&&"double"==j.turn("display")&&("ltr"==j.turn("direction")&&!j.turn("view")[0]||"rtl"==j.turn("direction")&&!j.turn("view")[1])&&(f.axis.x=f.axis.x+j.width()/2),e.zoom("scroll",y),e.bind(a.mouseEvents.down,d._eMouseDown),e.bind(a.mouseEvents.move,d._eMouseMove),a(document).bind(a.mouseEvents.up,f.mouseupEvent),e.bind("mousewheel",d._eMouseWheel),setTimeout(function(){f.zoomer.hide(),f.zoomer.remove(),f.zoomer=null,f.zoomerView=null},50)};return f.zoomer.css(z).show(),s?f.zoomer.bind(s,function(){a(this).unbind(s),A()}):setTimeout(A,f.opts.duration),f.zoomer.transform(g(v.x,v.y,!0)+h(k,!0)),this},zoomOut:function(b){var e,f=this,j=this.data().zoom,k=j.opts.flipbook,l=1,m=l/j.scale,n=a.cssPrefix(),o=a.cssTransitionEnd(),p=this.offset();if(b=void 0!==b?b:j.opts.duration,j.zoomIn){var q=a.Event("zoom.change");if(this.trigger(q,[l]),q.isDefaultPrevented())return this;j.zoomIn=!1,j.scale=l,k.data().noCenter=!1,f.unbind(a.mouseEvents.down,d._eMouseDown),f.unbind(a.mouseEvents.move,d._eMouseMove),a(document).unbind(a.mouseEvents.up,j.mouseupEvent),f.unbind("mousewheel",d._eMouseWheel);var r={};r[n+"transition"]=n+"transform "+j.opts.easeFunction+" "+b+"ms",k.css(r);var s,t=a("<div />",{css:{position:"relative",top:j.flipPosition.y,left:j.flipPosition.x,width:k.width()*m,height:k.height()*m,background:"blue"}}).appendTo(k.parent());s=i(t.offset().left-p.left,t.offset().top-p.top),t.remove();var u=k.data().opts.autoCenter;u&&"double"==k.turn("display")&&(k.turn("view")[0]?k.turn("view")[1]||(s.x="ltr"==k.turn("direction")?s.x+t.width()/4:s.x-t.width()/4):s.x="ltr"==k.turn("direction")?s.x-t.width()/4:s.x+t.width()/4);var v=a.findPos(k[0]);e=i(-k.width()/2-v.left+t.width()/2+s.x+p.left,-k.height()/2-v.top+t.height()/2+s.y+p.top);var w=function(){k[0].style.removeProperty?(k[0].style.removeProperty(n+"transition"),k.transform(k.turn("options").acceleration?g(0,0,!0):"").turn("zoom",1),k[0].style.removeProperty("margin"),k.css({position:"relative",top:j.flipPosition.y,left:j.flipPosition.x})):k.transform("none").turn("zoom",1).css({margin:"",top:j.flipPosition.y,left:j.flipPosition.x,position:"relative"}),u&&k.turn("center"),f.trigger("zoom.zoomOut")};return 0===b?w():o?(k.bind(o,function(){a(this).unbind(o),w()}),k.transform(g(e.x,e.y,!0)+h(m,!0))):(setTimeout(w,b),k.transform(g(e.x,e.y,!0)+h(m,!0))),this}},flipbookWidth:function(){var a=this.data().zoom,b=a.opts.flipbook,c=b.turn("view");return"double"!=b.turn("display")||c[0]&&c[1]?b.width():b.width()/2},scroll:function(c,d,e){var f=this.data().zoom,h=f.opts.flipbook,j=this.zoom("flipbookWidth"),k=a.cssPrefix();if(b){var l={};l[k+"transition"]=e?k+"transform 200ms":"none",h.css(l),h.transform(g(-f.axis.x-c.x,-f.axis.y-c.y,!0))}else h.css({top:-f.axis.y-c.y,left:-f.axis.x-c.x});if(!d){var m,n=i(Math.min(0,(j-this.width())/2),Math.min(0,(h.height()-this.height())/2)),o=i(j>this.width()?j-this.width():(j-this.width())/2,h.height()>this.height()?h.height()-this.height():(h.height()-this.height())/2);c.y<n.y?(c.y=n.y,m=!0):c.y>o.y&&(c.y=o.y,m=!0),c.x<n.x?(c.x=n.x,m=!0):c.x>o.x&&(c.x=o.x,m=!0),m&&this.zoom("scroll",c,!0,!0)}f.scrollPos=i(c.x,c.y)},resize:function(){var a=this.data().zoom,b=a.opts.flipbook;if(this.zoom("value")>1){var c=b.offset(),d=this.offset();a.axis=i(c.left-d.left+(a.axis.x+a.scrollPos.x),c.top-d.top+(a.axis.y+a.scrollPos.y)),"double"!=b.turn("display")||"ltr"!=b.turn("direction")||b.turn("view")[0]||(a.axis.x=a.axis.x+b.width()/2),this.zoom("scroll",a.scrollPos)}},_eZoom:function(){for(var b=this.data().zoom,c=b.opts.flipbook,d=c.turn("view"),e=0;e<d.length;e++)d[e]&&this.trigger("zoom.resize",[b.scale,d[e],c.data().pageObjs[d[e]]])},_eStart:function(a,b){1!=this.zoom("value")&&a.preventDefault()},_eTurning:function(a,b,c){var d=this,e=this.zoom("value"),f=this.data().zoom,g=f.opts.flipbook;if(f.page=g.turn("page"),1!=e){for(var h=0;h<c.length;h++)c[h]&&this.trigger("zoom.resize",[e,c[h],g.data().pageObjs[c[h]]]);setTimeout(function(){d.zoom("resize")},0)}},_eTurned:function(a,b){if(1!=this.zoom("value")){var d=this.data().zoom,e=d.opts.flipbook;b>d.page?this.zoom("scroll",i(0,d.scrollPos.y),!1,!0):b<d.page&&this.zoom("scroll",i(e.width(),d.scrollPos.y),!1,!0)}},_ePressed:function(){a(this).data().zoom.draggingCorner=!0},_eReleased:function(){var b=a(this).data().zoom;setTimeout(function(){b.draggingCorner=!1},1)},_eMouseDown:function(b){return a(this).data().zoom.draggingCur=a.isTouch?i(b.originalEvent.touches[0].pageX,b.originalEvent.touches[0].pageY):i(b.pageX,b.pageY),!1},_eMouseMove:function(b){var c=a(this).data().zoom;if(c.draggingCur){c.dragging=!0;var d=a.isTouch?i(b.originalEvent.touches[0].pageX,b.originalEvent.touches[0].pageY):i(b.pageX,b.pageY),e=i(d.x-c.draggingCur.x,d.y-c.draggingCur.y);return a(this).zoom("scroll",i(c.scrollPos.x-e.x,c.scrollPos.y-e.y),!0),c.draggingCur=d,!1}},_eMouseUp:function(b){var c=a(this).data().zoom;c.dragging&&a(this).zoom("scroll",c.scrollPos),c.draggingCur=null,setTimeout(function(){c.dragging=!1},1)},_eMouseWheel:function(b,c,d,e){var f=a(this).data().zoom,g=i(f.scrollPos.x+10*d,f.scrollPos.y-10*e);a(this).zoom("scroll",g,!1,!0)},_eTouchStart:function(b,c){var d=a(this).data().zoom,f=(d.opts.flipbook,i(b.originalEvent.touches[0].pageX,b.originalEvent.touches[0].pageY));d.touch={},d.touch.initial=f,d.touch.last=f,d.touch.timestamp=(new Date).getTime(),d.touch.speed=i(0,0)},_eTouchMove:function(b){var c=a(this).data().zoom,d=a(this).zoom("value"),e=c.opts.flipbook,f=(new Date).getTime(),g=i(b.originalEvent.touches[0].pageX,b.originalEvent.touches[0].pageY);c.touch&&1==d&&!e.data().mouseAction&&(c.touch.motion=i(g.x-c.touch.last.x,g.y-c.touch.last.y),c.touch.speed.x=0===c.touch.speed.x?c.touch.motion.x/(f-c.touch.timestamp):(c.touch.speed.x+c.touch.motion.x/(f-c.touch.timestamp))/2,c.touch.last=g,c.touch.timestamp=f)},_eTouchEnd:function(b){var c=a(this).data().zoom;if(c.touch&&1==a(this).zoom("value")){var d=Math.abs(c.touch.initial.y-c.touch.last.y);d<50&&(c.touch.speed.x<-1||c.touch.last.x-c.touch.initial.x<-100)?this.trigger("zoom.swipeLeft"):d<50&&(c.touch.speed.x>1||c.touch.last.x-c.touch.initial.x>100)&&this.trigger("zoom.swipeRight")}},_eDestroying:function(){var b=this,c=this.data().zoom,e=c.opts.flipbook,f=["tap","doubleTap","resize","zoomIn","zoomOut","swipeLeft","swipeRight"];this.zoom("zoomOut",0),a.each(f,function(a,c){b.unbind("zoom."+c)});for(var g in c.flipbookEvents)Object.prototype.hasOwnProperty.call(c.flipbookEvents,g)&&e.unbind(g,c.flipbookEvents[g]);e.unbind("touchstart",c.eventTouchStart).unbind("touchmove",c.eventTouchMove).unbind("touchend",c.eventTouchEnd),this.unbind("touchstart",d._tap).unbind("click",d._tap),c=null,this.data().zoom=null}};a.extend(a.fn,{zoom:function(){var b=arguments;if(b[0]&&"object"!=typeof b[0]){if(d[b[0]])return d[b[0]].apply(a(this[0]),Array.prototype.slice.call(b,1));throw f(b[0]+" is not a method")}return d.init.apply(a(this[0]),b)}})}(jQuery);
