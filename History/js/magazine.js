function addPage(a,b){var e=(b.turn("pages"),$("<div />",{}));b.turn("addPage",e,a)&&(e.html('<div class="gradient"></div><div class="loader"></div>'),loadPage(a,e))}function loadPage(a,b){var c=$("<img />");c.mousedown(function(a){a.preventDefault()}),c.load(function(){$(this).css({width:"100%",height:"100%"}),$(this).appendTo(b),b.find(".loader").remove()}),c.attr("src","pic/"+a+".png"),loadRegions(a,b)}function zoomTo(a){setTimeout(function(){$(".magazine-viewport").data().regionClicked?$(".magazine-viewport").data().regionClicked=!1:1==$(".magazine-viewport").zoom("value")?$(".magazine-viewport").zoom("zoomIn",a):$(".magazine-viewport").zoom("zoomOut")},1)}function loadRegions(a,b){$.getJSON("pic/"+a+".json").done(function(a){$.each(a,function(a,c){addRegion(c,b)})})}function addRegion(a,b){var c=$("<div />",{class:"region  "+a.class}),d=$(".magazine").turn("options"),e=d.width/2,f=d.height;c.css({top:Math.round(a.y/f*100)+"%",left:Math.round(a.x/e*100)+"%",width:Math.round(a.width/e*100)+"%",height:Math.round(a.height/f*100)+"%"}).attr("region-data",$.param(a.data||"")),c.appendTo(b)}function regionClick(a){var b=$(a.target);if(b.hasClass("region")){$(".magazine-viewport").data().regionClicked=!0,setTimeout(function(){$(".magazine-viewport").data().regionClicked=!1},100);return processRegion(b,$.trim(b.attr("class").replace("region","")))}}function processRegion(a,b){switch(data=decodeParams(a.attr("region-data")),b){case"link":window.open(data.url);break;case"zoom":var c=a.offset(),d=$(".magazine-viewport").offset(),e={x:c.left-d.left,y:c.top-d.top};$(".magazine-viewport").zoom("zoomIn",e);break;case"to-page":$(".magazine").turn("page",data.page)}}function loadLargePage(a,b){var c=$("<img />");c.load(function(){var a=b.find("img");$(this).css({width:"100%",height:"100%"}),$(this).appendTo(b),a.remove()}),c.attr("src","pic/"+a+".png")}function loadSmallPage(a,b){var c=b.find("img");c.css({width:"100%",height:"100%"}),c.unbind("load"),c.attr("src","pic/"+a+".png")}function isChrome(){return-1!=navigator.userAgent.indexOf("Chrome")}function disableControls(a){1==a?$(".previous-button").hide():$(".previous-button").show(),a==$(".magazine").turn("pages")?$(".next-button").hide():$(".next-button").show()}function resizeViewport(){var a=$(window).width(),b=$(window).height(),c=$(".magazine").turn("options");if($(".magazine").removeClass("animated"),$(".magazine-viewport").css({width:a,height:b}).zoom("resize"),1==$(".magazine").turn("zoom")){var d=calculateBound({width:c.width,height:c.height,boundWidth:Math.min(c.width,a),boundHeight:Math.min(c.height,b)});d.width%2!=0&&(d.width-=1),d.width==$(".magazine").width()&&d.height==$(".magazine").height()||($(".magazine").turn("size",d.width,d.height),1==$(".magazine").turn("page")&&$(".magazine").turn("peel","br"),$(".next-button").css({height:d.height,backgroundPosition:"-38px "+(d.height/2-16)+"px"}),$(".previous-button").css({height:d.height,backgroundPosition:"-4px "+(d.height/2-16)+"px"})),$(".magazine").css({top:-d.height/2,left:-d.width/2})}var e=$(".magazine").offset(),f=b-e.top-$(".magazine").height(),g=(f-$(".thumbnails > div").height())/2;g<0?$(".thumbnails").css({height:1}):($(".thumbnails").css({height:f}),$(".thumbnails > div").css({marginTop:g})),e.top<$(".made").height()?$(".made").hide():$(".made").show(),$(".magazine").addClass("animated")}function numberOfViews(a){return a.turn("pages")/2+1}function getViewNumber(a,b){return parseInt((b||a.turn("page"))/2+1,10)}function moveBar(a){Modernizr&&Modernizr.csstransforms&&$("#slider .ui-slider-handle").css({zIndex:a?-1:1e4})}function setPreview(a){var b=112,c=73,e=$(_thumbPreview.children(":first")),f=1==a||a==$("#slider").slider("option","max")?1:2,g=1==f?b/2:b;_thumbPreview.addClass("no-transition").css({width:g+15,height:c+15,top:-c-30,left:($($("#slider").children(":first")).width()-g-15)/2}),e.css({width:g,height:c}),""!==e.css("background-image")&&"none"!=e.css("background-image")||(e.css({backgroundImage:"url(pic/preview.jpg)"}),setTimeout(function(){_thumbPreview.removeClass("no-transition")},0)),e.css({backgroundPosition:"0px -"+(a-1)*c+"px"})}function largeMagazineWidth(){return 2214}function decodeParams(a){for(var c,b=a.split("&"),d={},e=0;e<b.length;e++)c=b[e].split("="),d[decodeURIComponent(c[0])]=decodeURIComponent(c[1]);return d}function calculateBound(a){var b={width:a.width,height:a.height};if(b.width>a.boundWidth||b.height>a.boundHeight){var c=b.width/b.height;a.boundWidth/c>a.boundHeight&&a.boundHeight*c<=a.boundWidth?(b.width=Math.round(a.boundHeight*c),b.height=a.boundHeight):(b.width=a.boundWidth,b.height=Math.round(a.boundWidth/c))}return b}
